# Changelog

All notable changes to this project will be documented in this file.

The format is based on [Keep a Changelog](https://keepachangelog.com/en/1.1.0/),
and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0.html).

## [Unreleased]

### Added

- Shared prompt page (shared-001, shared-002)
  - `/shared/[token]` route for viewing shared prompts via token
  - SharedPromptDetailContent component with title, author, description, content
  - Copy button with clipboard functionality and toast feedback
  - Error state for invalid/expired tokens with retry and home navigation
  - Loading skeleton during data fetch
  - Uses `useGetSharedShareToken` hook from generated API client
- Variable validation for template copy (template-004)
  - "Copy with Variables" option disabled when not all variables are filled
  - Warning icon (amber) shown for unfilled variables
  - Tooltip displays list of unfilled variable names
  - `areAllVariablesFilled()` and `getUnfilledVariables()` utilities in templates.ts
  - Added shadcn/ui Tooltip component
- Prompts list filters (prompts-list-007, prompts-list-008, prompts-list-010, prompts-list-011)
  - Filter by folder dropdown showing all user folders with "All folders" option
  - Filter by tags multi-select with tag badges for selected tags
  - Filter by visibility dropdown (All/Public/Private/Shared options)
  - Skeleton loaders during data fetch matching PromptCard dimensions
  - Active filters shown as dismissible badges with clear all button
  - Mobile-responsive filters in collapsible sheet
  - Filter state synced to URL params (folder, tags, visibility)
  - usePromptsFilters hook for centralized filter state management
  - New filter components: FolderFilter, TagFilter, VisibilityFilter, ActiveFilters, PromptsFilters, PromptsFiltersMobile
- E2E tests for auth error handling (auth-006-tests)
  - Tests for rate limit (429) errors showing toast with retry time
  - Tests for rate limit disabling submit button
  - Tests for network errors showing connection toast
  - Tests for server errors (500) showing generic error toast
  - Tests for token not being stored on errors
  - API mock helpers: mockLoginRateLimit, mockLoginServerError, mockLoginNetworkError
- E2E tests for logout functionality (auth-007-tests)
  - Tests for successful logout clearing tokens from localStorage
  - Tests for logout redirecting to login page
  - Tests for logout preventing access to protected routes
  - Tests for logout with server error still clearing local tokens
  - Tests for showing error toast on server error but still redirecting
  - API mock helper: mockLogoutError
- E2E tests for password visibility toggle (auth-005-tests)
  - Tests for password field starting with type="password"
  - Tests for toggle changing input type to text
  - Tests for toggle returning type to password on second click
  - Tests for accessible labels (Show password/Hide password)
  - Tests for register page with independent toggles for both password fields
- Password visibility toggle on login and register forms (auth-005)
  - Eye/EyeOff icon button to toggle password visibility
  - Accessible aria-label changes between "Show password" and "Hide password"
  - Register form has independent toggles for password and confirm password fields
- Share prompt functionality (sharing-001, sharing-002)
  - Share button in prompt detail header and mobile dropdown
  - ShareModal component with share link generation
  - Copy share link to clipboard with success feedback
  - useSharePrompt hook wrapping POST /prompts/{id}/share
- Public gallery detail page (gallery-004, gallery-005, gallery-006, gallery-007)
  - `/gallery/[id]` route for viewing public prompts
  - Read-only view with title, author, description, content
  - View count, fork count, and likes count display
  - Copy content button
  - Like/unlike toggle with optimistic updates
  - Fork to My Prompts button with auth check
  - Skeleton and error components for loading states
- Public gallery page with infinite scroll (gallery-002)
  - Gallery page at `/gallery` with grid card layout (1/2/3 columns responsive)
  - Infinite scroll pagination using react-intersection-observer
  - Search input with debounced query (300ms)
  - Empty states for no results and no search matches
  - Error state with retry button
  - Loading skeletons matching card layout
  - PublicPromptCard component showing title, author, date, view/use counts
  - useInfinitePublicPrompts hook with TanStack Query infinite queries
- Version history slide-in panel (prompts-detail-006)
  - History button in prompt detail header and mobile dropdown
  - Sheet component sliding from right side
  - Version list with version number, date, and content preview
  - Click version to select and compare with current content
  - Diff view showing changes between selected version and current
  - Restore button with confirmation dialog
  - useRestoreVersion hook with cache invalidation
  - VersionHistorySheet component
- Generate Tags AI feature for inline tag editor (ai-004)
  - Sparkles button in inline tag editor to generate tag suggestions
  - Sequential tag suggestions shown one at a time
  - Accept (click tag name) or dismiss (X button) each suggestion
  - 5-second auto-dismiss timeout per suggestion
  - useGenerateTags hook wrapping POST /prompts/{id}/generate-tags
  - TagSuggestion component with accept/dismiss UI
  - LoadingDots animation during generation

- Improve with AI feature (ai-001, ai-002, ai-003)
  - "Improve with AI" button on prompt detail page header with Sparkles icon
  - Mobile dropdown menu option for Improve with AI
  - Modal with animated bouncing dots loading state
  - Inline diff view showing removed text in red (line-through) and added text in green
  - Accept/Reject/Edit buttons in modal footer
  - Edit mode allows modifying improved content before accepting
  - Accept saves improved content via PATCH /prompts/{id}
  - Reject closes modal without changes
  - Rate limit (429) errors shown via toast notification
  - `diff` library (jsdiff) for word-level diff computation
  - New files:
    - `src/lib/utils/diff.ts` - computeWordDiff utility
    - `src/components/prompts/improve-loading-state.tsx` - Animated loading dots
    - `src/components/prompts/diff-view.tsx` - Inline diff display component
    - `src/components/prompts/improve-prompt-modal.tsx` - Main modal component
    - `src/hooks/use-improve-prompt.ts` - Hook wrapping AI improve API
- Live template preview functionality (template-003)
  - Preview section shown below variable input form when values are entered
  - Real-time rendering of template with filled variable values
  - Copy button next to preview to copy rendered content
  - "Copy with Variables" dropdown option now uses rendered content
  - Client-side `renderTemplate()` utility for instant feedback
- Variable input form for templates (template-002)
  - Form on prompt detail page to fill in template variables
  - Input field for each detected `{{variable}}` with required indicator (*)
  - Default values pre-populated from `{{variable:default}}` syntax
  - "Remember values" checkbox persists values in localStorage per prompt
  - "Clear all" button resets form to defaults
  - VariableInputForm component with shadcn Card, Input, Checkbox
- Template variable extraction UI (template-001)
  - Highlights `{{variable}}` and `{{variable:default}}` syntax in prompt content preview
  - Variables displayed with terracotta-tinted background in view mode
  - "Template Variables" section below content shows extracted variable badges
  - Variable badges show name and default value (e.g., `topic`, `audience = general`)
  - Client-side extraction for immediate feedback, API fetch for authoritative data
  - Shared template constants and utilities in `/src/lib/constants/templates.ts` and `/src/lib/utils/templates.ts`
- Inline editing on prompt detail page (prompts-detail-005)
  - Click Edit to transform title, content, description into editable fields in place
  - Visibility selector shown inline during edit mode
  - Save/Cancel buttons replace Edit/Delete when editing
  - Escape key cancels edit mode and restores original values
  - Auto-save on blur: clicking outside the edit area saves changes
  - Only sends changed fields to API (delta updates)
  - Removed separate EditPromptForm component in favor of inline editing
- Mobile-responsive actions dropdown on prompt detail page (prompts-detail-004)
  - Desktop (≥768px): Edit and Delete buttons shown as before
  - Mobile (<768px): Actions collapsed into three-dot dropdown menu
  - PromptActionsDropdown component with Edit and Delete options
  - Delete option uses destructive styling
- Copy dropdown with multiple format options (prompts-detail-003)
  - Copy dropdown menu on prompt detail page replaces single button
  - Copy as Plain Text: copies raw prompt content
  - Copy as Markdown: copies formatted with title, description, content, and tags
  - Copy with Variables: shown only when prompt contains {{variable}} templates
  - CopyPromptDropdown component using shadcn DropdownMenu
- Sort dropdown for prompts list (prompts-list-009)
  - Sort dropdown in My Prompts page header with ArrowDownUp icon
  - Options: Recently Modified (default), Date Created, Most Used
  - Sort selection persisted in URL params (?sort=...)
  - Default sort is -updated_at, omitted from URL for cleaner links
  - PromptsSortDropdown component using shadcn Select
- Search functionality for prompts list (prompts-list-009)
  - Search input with magnifying glass icon in prompts list header
  - Debounced search query (300ms) to minimize API calls
  - Clear button appears when search has content
  - Search filters prompts via API `search` query parameter
  - useDebounce hook for reusable debounce logic
  - PromptsSearch component with search/clear UI
- Enhanced empty state with CTA (prompts-list-006)
  - Illustration icon in empty state
  - "Create your first prompt" CTA button opens create modal
  - Different empty state for filtered results vs no prompts
  - Filtered empty state shows search term and suggestion to clear
- E2E tests for empty state and search functionality
  - Tests for empty state illustration and CTA button
  - Tests for filtered empty state with search active
  - PromptsListPage page object updated with new locators

- View mode toggle for prompts list (prompts-list-013, prompts-list-002)
  - Toggle button in My Prompts page header switches between compact and expanded views
  - Compact view: Row-based list layout with minimal information
  - Expanded view: Card grid with content preview (150 chars), description, view count
  - View preference persists in localStorage (key: promptarchive-view-mode)
  - Toggle hidden on mobile (< 768px) - always shows compact view
  - useViewMode hook using useSyncExternalStore for proper SSR handling
  - PromptCard component for expanded grid view
  - PromptCardSkeleton component for loading state
  - ViewModeToggle component with List/LayoutGrid icons
- Prompt deletion functionality (prompts-crud-007)
  - Delete button on prompt detail page with destructive styling
  - DeletePromptDialog component with AlertDialog for confirmation
  - useDeletePrompt hook with cache invalidation and toast notifications
  - Redirects to /prompts after successful deletion
  - Added shadcn AlertDialog component for confirmation dialogs
- Comprehensive E2E test coverage for all uncovered pages
  - Prompts List Page tests (12 tests): initial load, empty state, error state, navigation, copy
  - Create Prompt Modal tests (14 tests): form validation, success/error flows, cancel behavior
  - Prompt Detail Page tests (22 tests): view mode, edit mode, error state, copy, API errors
  - Settings Page tests (4 tests): page access, protected route redirect
  - Home Page Redirect tests (2 tests): auth-based routing
  - Page Object Models: PromptsListPage, PromptDetailPage, CreatePromptModal, SettingsPage, HomePage
  - API mock helpers: mockPromptsListError, mockCreatePromptError, mockUpdatePromptError
  - Consolidated route handling with route.fallback() for proper handler chaining
  - Added clipboard permissions to Playwright config for copy tests

### Changed

- Extracted AuthenticatedLayout component to reduce layout duplication
- Consolidated visibility configuration into shared utility module
- Added explicit React.ReactElement return types to page components
- Removed redundant section comments from prompt-row components

### Added

- Prompt update API integration (prompts-crud-006)
  - Edit button on prompt detail page opens inline edit form
  - EditPromptForm component with title, content, description, visibility fields
  - useUpdatePrompt hook with optimistic updates and error rollback
  - PATCH /prompts/{id} called with only changed fields
  - Query invalidation for prompt detail and list after successful update
  - Toast notifications for success/error feedback
  - Escape key cancels edit mode
  - Update validation schema added to prompt validations
- Prompt detail page (prompts-detail-001)
  - Dynamic route at `/prompts/[id]` for viewing individual prompts
  - Fetches prompt data using `useGetPromptsId` hook on page load
  - Displays title, content (with serif font), and full metadata
  - Metadata includes: visibility icon/label, folder badge, relative date, use count, view count
  - Tags displayed as badges
  - Description shown when present
  - Content block with copy button and clipboard feedback
  - Breadcrumb navigation back to prompts list
  - Loading skeleton during data fetch
  - Error state with retry button for not found/permission errors
  - Components: PromptDetailContent, PromptDetailSkeleton, PromptDetailError
- Prompt creation flow (prompts-list-012, prompts-crud-001, prompts-crud-002)
  - "New Prompt" button in prompts page header with Plus icon
  - CreatePromptModal component using Dialog with size="md" (550px)
  - CreatePromptForm with Zod validation and react-hook-form
  - Form fields: title (max 200 chars), content (auto-expanding, max 50KB), description (optional, max 1000 chars), visibility select (private/public/unlisted)
  - Validation errors shown on submit only (mode: "onSubmit")
  - API integration with usePostPrompts mutation hook
  - Query invalidation to refresh prompts list after creation
  - Toast notifications for success/error feedback
  - AutoExpandTextarea component for dynamic content field height
  - Added shadcn/ui Textarea and Select components

### Changed

- Converted PromptCard to PromptRow with row-based layout (prompts-list-001-bugfix)
  - Renamed `prompt-card.tsx` to `prompt-row.tsx` for semantic clarity
  - Replaced card grid layout with flex row list layout
  - Row contains: title, folder badge, tags (max 3), visibility icon, date, use_count, copy button
  - Hover state changed from shadow to subtle background color (`bg-accent/50`)
  - Responsive layout: stacks vertically on mobile, horizontal row on desktop
  - Container uses `divide-y` border styling for clean list appearance
  - Updated skeleton component to match row layout

### Added

- PromptCard compact view updates (prompts-list-001)
  - Visibility icon (Lock for private, Globe for public/unlisted) replacing text badge
  - Usage counter displaying use_count field
  - Quick copy button with clipboard feedback (Check icon)
  - Removed content preview for compact mode per design spec
  - Updated PromptCardSkeleton to match new compact layout
- useCopyToClipboard hook (`src/hooks/use-copy-to-clipboard.ts`)
  - Reusable clipboard functionality with toast notifications
  - Returns copy function and copied state for UI feedback
- Base modal/dialog component (design-005)
  - Added shadcn/ui Dialog component with size variants (sm: 400px, md: 550px, lg: 800px)
  - Mobile full-screen behavior (< 768px viewport)
  - Close on backdrop click and Escape key (built into Radix primitives)
  - Size prop on DialogContent with `data-size` attribute for styling
  - Exports: Dialog, DialogTrigger, DialogContent, DialogHeader, DialogFooter, DialogTitle, DialogDescription, DialogClose

### Changed

- Updated PRD.json with refined task specifications
  - PromptCard (compact): Updated DoD to include usage counter, copy button, visibility icon, no content preview
  - PromptCard (expanded): Added description field, content preview (100-200 chars), full statistics
  - Sort dropdown: Added sort options (Recently Modified, Date Created, Most Used, Most Forked)
  - View mode toggle: New task for compact/expanded view switching
  - Prompt form: Simplified to exclude folder/tag selectors (moved to detail page)
  - Version history: Changed to slide-in panel from right side
  - Inline tag/folder selection: New tasks for prompt detail page
  - AI features: Updated UI specs for improve modal, diff view, tag suggestions
  - Rate limit: Simplified to toast-only feedback (no cooldown timer)
  - Gallery: Updated card layout specs, sorting options
  - Mobile: Clarified limited functionality (view/browse/copy only)

### Added

- Home page redirect based on auth state (design-003)
  - Authenticated users redirected to /prompts
  - Unauthenticated users redirected to /gallery
  - Removed default Next.js template content
  - Uses existing AuthContext pattern with LoadingSpinner
- Header with full navigation (design-002)
  - Navigation links: My Prompts, Gallery, Settings
  - Active route highlighting using usePathname
  - Conditional logo navigation (/prompts for auth, /login for unauth)
  - Mobile burger menu using shadcn/ui Sheet component
  - Auth-based navigation filtering (My Prompts and Settings require auth)
  - Added shadcn/ui Sheet component for mobile navigation
- Typography system configuration (design-001)
  - Inter font from Google Fonts for UI elements (default font)
  - Spectral font from Google Fonts for prompt content
  - CSS variables `--font-inter` and `--font-spectral` via next/font
  - `--font-sans` updated to use Inter with system font fallbacks
  - `--font-serif` added for Spectral with serif fallbacks
  - Utility classes `.font-ui` and `.font-content` in `@layer utilities`
- Design system tasks in PRD.json
  - Added `design-system` category as first category
  - design-001: Configure typography system (Inter + Spectral fonts)
  - design-002: Update header with full navigation
  - design-003: Configure home page redirect
  - design-004: Apply typography to PromptCard
  - design-005: Create base modal/dialog component
  - Corresponding test tasks for each design task
- UI-UX-DESIGN.md specification document with complete design guidelines
  - Branding and visual identity (warm neutrals, terracotta accent)
  - Information architecture (navigation, routes, filters)
  - Card and list system patterns
  - Interaction patterns (modals, forms, feedback)
  - AI features specifications
  - Mobile responsiveness rules
- Test user credentials in CLAUDE.md for staging environment
- Prompts list page with data fetching (prompts-list-003)
  - GET /prompts called with useGetPrompts hook (TanStack Query)
  - List renders PromptCard components in responsive grid (1/2/3 columns)
  - Loading skeleton shown during fetch (6 skeleton cards)
  - Error state with retry button
  - Empty state for when no prompts exist
  - Added shadcn/ui Skeleton component
  - Added PromptCardSkeleton component (`src/components/prompts/prompt-card-skeleton.tsx`)
- PromptCard component for compact prompt display (prompts-list-001)
  - Card displays title (truncated), content preview, folder, and tags
  - Visibility badge with appropriate styling (Public/Private/Unlisted)
  - Relative date formatting for updated timestamp
  - Hover effect with shadow elevation
  - Click navigation to prompt detail page
  - Added shadcn/ui Card and Badge components
  - Added formatRelativeDate utility function (`src/lib/utils.ts`)
- Auth error handling with toast notifications (auth-006)
  - New auth-error utility for centralized error handling (`src/lib/utils/auth-error.ts`)
  - Network errors show "Unable to connect" message
  - Rate limit (429) errors show countdown and disable submit button
  - Server errors (5xx) show "Something went wrong" message
  - Duplicate email errors shown inline on email field
  - Invalid credentials shown via toast notification
  - Rate limit countdown timer in login and register forms
- Logout functionality (auth-007)
  - Header component with brand logo and user menu (`src/components/layout/header.tsx`)
  - UserMenu component with user avatar dropdown (`src/components/layout/user-menu.tsx`)
  - useLogout hook that calls POST /auth/logout API (`src/hooks/use-logout.ts`)
  - Logout clears tokens from localStorage and redirects to /login
  - Graceful error handling - clears local state even if API call fails
  - Added shadcn/ui Avatar and DropdownMenu components
- Protected route middleware (auth-004)
  - Next.js proxy for server-side route protection (`src/proxy.ts`)
  - Auth cookie utilities for syncing auth state (`src/lib/utils/auth-cookie.ts`)
  - AuthGuard component for protected pages (`src/components/auth/auth-guard.tsx`)
  - GuestGuard component for guest-only pages (`src/components/auth/guest-guard.tsx`)
  - LoadingSpinner shared component (`src/components/ui/loading-spinner.tsx`)
  - Protected /prompts and /settings routes with placeholder pages
  - Redirect to original URL after login via query param
  - Authenticated users redirected from login/register to /prompts
- E2E tests for protected route middleware (auth-004-tests)
  - Test: Unauthenticated user redirected from /prompts to /login
  - Test: Redirect includes original URL as query parameter
  - Test: Authenticated user redirected from /login to /prompts
  - Test: Redirect preserves original destination after login
- Auth context/state management (auth-003)
  - AuthContext with user, isAuthenticated, isLoading states (`src/lib/contexts/auth-context.tsx`)
  - useAuth hook for consuming auth context (`src/hooks/use-auth.ts`)
  - Session restoration on app mount via GET /auth/me
  - Login form now updates auth context on successful login
- E2E tests for auth context (auth-003-tests)
  - Test: AuthProvider initializes with null user when no token exists
  - Test: Valid token restores user session
  - Test: Invalid token clears localStorage
- E2E tests for registration form (auth-002-tests)
  - RegisterPage Page Object Model (`e2e/pages/register.page.ts`)
  - Registration test suite with 13 test cases covering success, failure, validation, and initial state
  - Register endpoint mock in API fixtures (201 success, 409 duplicate email)
  - REGISTER_CREDENTIALS test data for various validation scenarios
- Pre-commit hook with Husky that runs linting, build, and E2E tests before each commit
- Registration page with form validation (`/register`)
- Registration form component with Zod validation (name, email, password with confirmation)
- Register schema with password match validation (`src/lib/validations/auth.ts`)
- E2E testing infrastructure with Playwright
  - `playwright.config.ts` with Chromium project, auth setup, and web server config
  - Page Object Model pattern (`e2e/pages/login.page.ts`)
  - API mock fixtures with Playwright route interception (`e2e/fixtures/`)
  - Auth fixtures for authenticated/unauthenticated test scenarios
  - Login flow test suite with 13 test cases covering success, failure, and validation
  - GitHub Actions workflow for CI (`e2e-tests.yml`)
  - npm scripts: `test:e2e`, `test:e2e:ui`, `test:e2e:debug`, `test:e2e:headed`, `test:e2e:report`, `test:e2e:codegen`
- Test task entries in PRD.json for all existing features (auth, prompts, templates, AI, folders, sharing, gallery, settings)
- Login page with form validation (`/login`)
- Login form component with Zod validation (email, password min 8 chars)
- Sonner toast notifications for error/success messages
- shadcn/ui form components (form, input, button, label)
- Auth validation schemas (`src/lib/validations/auth.ts`)
- TanStack Query (`@tanstack/react-query`) with QueryClientProvider
- Orval for API client generation from swagger.yaml
- shadcn/ui component library (New York style)
- Zod, react-hook-form, @hookform/resolvers for form handling
- Axios instance with JWT refresh interceptors
- Custom theme: warm beige/sand background with terracotta accent
- Project folder structure: components/, hooks/, lib/api/, lib/validations/, types/

### Changed

- Prompts and Settings layouts now include Header component for authenticated pages
- Updated PRD.json API endpoints to match backend implementation (PUT → PATCH for updates)
- Aligned API paths in PRD.json with actual backend routes

### Fixed

- Axios interceptor now skips token refresh for auth endpoints (prevents redirect loop on login failure)

### Removed

- Removed swagger.yaml (API specs managed in backend repo)
- Removed deprecated PRD items: auth-008 (logout all devices duplicate), sharing-003 (active share links display), settings-001 (profile section), settings-002 (password change)
